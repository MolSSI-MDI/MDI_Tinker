code_name: 'Tinker'
docker:
  image_name: 'mdi/tinker'

  build_image:
    - apt-get update
    - apt-get install -y git
    - pip install cmake

  build_engine:
    - |
      if [ ! -d "build/tinker" ]; then
        git clone https://github.com/MolSSI-MDI/Tinker.git --branch mdi build/tinker
      fi
    - cd build/tinker/dev
    - ./full_build.sh

  validate_engine:
    # Confirm that the engine's executable exists
    - ENGINE_EXECUTABLE="build/tinker/build/tinker/source/dynamic.x"
    - |
      if test -f "$ENGINE_EXECUTABLE"; then
        echo "$ENGINE_EXECUTABLE exists"
      else
        echo "Could not find engine executable: $ENGINE_EXECUTABLE"
        exit 1
      fi

engine_tests:
  # Provide at least one example input that can be used to test your code's MDI functionality
  script:
    - cd tests/water
    - cp ../../build/tinker/build/tinker/params/amoebabio18.prm .
    - ../../build/tinker/build/tinker/source/dynamic.x tinker.in amoebabio18.prm -k tinker.key -mdi "${MDI_OPTIONS}" 1000 1.0 10.0 2 298.0 778.0 > tinker.out


test_drivers:
  test_driver:
    script:
      - cd tests/driver
      - python driver.py -mdi "-role DRIVER -name driver -method TCP -port 8021"
